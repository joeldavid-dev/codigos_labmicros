processor 16f877
include <p16f877.inc>

valor1 equ h'21'
valor2 equ h'22'
valor3 equ h'23'
cte1 equ 80h
cte2 equ 50h
cte3 equ 60h

VAR1 equ h'25'
VAR2 equ h'26'

ORG 0
GOTO INICIO
ORG 5

INICIO:
	CLRF PORTA		; PORTA = 0
	BSF STATUS,RP0
	BCF STATUS,RP1	; Mueve a banco 1
	MOVLW H'0'		; w <- 0
	MOVWF TRISB		; TRISB = 0, configura como salida
 	CLRF PORTB		; Limpia los puertos

	MOVLW 06H		; w = 6H
	MOVWF ADCON1	; ADCON1 = 6H, para configurar puerto A como digital
	MOVLW 0FH		; w = "0000 1111"
	MOVWF TRISA		; TRISA = "0000 1111", configura puerto a como entrada, solo primeros 4 bits
	BCF STATUS, RP0	; Regresa al banco 0
	CLRF VAR1		;
	CLRF VAR2		; Limpia las variables


loop2:
	MOVF PORTA, W	; W <- Entradas en A
	ANDLW 0X0F		; W -> PORTA & 00001111
 	ADDWF PCL, F	; Suma la entrada en A a pcl para dar el salto
	GOTO ACCION1
	GOTO ACCION2
	GOTO ACCION3
	GOTO ACCION4
	GOTO ACCION5

ACCION1:
	MOVLW 0X00		; PARO-PARO
	MOVWF PORTB
	MOVWF VAR1
	MOVWF VAR2
	GOTO loop2

ACCION2:			; GIRA EN SENTIDO HORARIO
	MOVLW B'11000000'
	MOVWF PORTB
	CALL RETARDO
	MOVLW B'01100000'
	MOVWF PORTB
	CALL RETARDO
	MOVLW B'00110000'
	MOVWF PORTB
	CALL RETARDO
	MOVLW B'10010000'
	MOVWF PORTB
	CALL RETARDO
	GOTO loop2

ACCION3:			; GIRA EN SENTIDO ANTI-HORARIO
	MOVLW B'10010000'
	MOVWF PORTB
	CALL RETARDO
	MOVLW B'00110000'
	MOVWF PORTB
	CALL RETARDO
	MOVLW B'01100000'
	MOVWF PORTB
	CALL RETARDO
	MOVLW B'11000000'
	MOVWF PORTB
	CALL RETARDO
	GOTO loop2

ACCION4:			; GIRA 5 VUELTAS SENTIDO HORARIO
	MOVLW 05H
	SUBWF VAR1,W
	BTFSC STATUS, Z
	GOTO loop2
	
	INCF VAR1
	MOVLW B'11000000'
	MOVWF PORTB
	CALL RETARDO
	MOVLW B'01100000'
	MOVWF PORTB
	CALL RETARDO
	MOVLW B'00110000'
	MOVWF PORTB
	CALL RETARDO
	MOVLW B'10010000'
	MOVWF PORTB
	CALL RETARDO
	GOTO loop2


ACCION5:			; GIRA 10 VUELTAS SENTIDO ANTIHORARIO
	MOVLW 0AH
	SUBWF VAR2,W
	BTFSC STATUS, Z
	GOTO loop2
	
	INCF VAR2
	MOVLW B'10010000'
	MOVWF PORTB
	CALL RETARDO
	MOVLW B'00110000'
	MOVWF PORTB
	CALL RETARDO
	MOVLW B'01100000'
	MOVWF PORTB
	CALL RETARDO
	MOVLW B'11000000'
	MOVWF PORTB
	CALL RETARDO
	GOTO loop2

RETARDO:
	MOVLW cte1
 	MOVWF valor1

tres:
	MOVLW cte2
	MOVWF valor2

dos:
	MOVLW cte3
	MOVWF valor3

uno:
	DECFSZ valor3
	GOTO uno
	DECFSZ valor2
	GOTO dos
	DECFSZ valor1
	GOTO tres
	RETURN

END